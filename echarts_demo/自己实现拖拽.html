<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../public/header.js"></script>
</head>
<body>
<script>
    let myecharts=echarts.init(document.getElementById('main1'));
    let symbolSize=20;
    let data=[[15, 0], [-50, 10], [-56.5, 20], [-46.5, 30], [-22.1, 40]];
    option={
        title:{
            text:'实现图表拖拽'
        },
        grid:{},
        tooltip:{
            triggerOn:'none',  //提示框触发的条件
            formatter:function (params) {
                return 'X： '+params.data[0].toFixed(2)+'<br>'+'Y： '+params.data[1].toFixed(2)
            }
        },
        toolbox:{
            show:true,
            orient:'vertical',
            left:'10',
            itemGap: 20,
            top:'center',
            feature:{
                dataView:{
                  show:true,
                  readOnly:true
                },
                magicType:{
                    type:['line','bar']
                },
                saveAsImage:{
                    show:true,
                }
            }
        },
        xAxis:{
            min:-100,
            max:80,
            type:'value',
            axisLine:{
                onZero:false
            }
        },
        yAxis:{
            min:-30,
            max:60,
            type:'value',
            axisLine:{
                onZero:false
            }
        },
        dataZoom:[
            {
                type:'slider',
                xAxisIndex:0,
                filterMode:'empty'
            },
            {
                type:'slider',
                yAxisIndex:0,
                filterMode:'empty'
            },
            {
                type:'inside',
                xAxisIndex:0,
                filterMode:'empty'
            },
            {
                type:'inside',
                yAxisIndex:0,
                filterMode:'empty'
            }
        ],
        series:[
            {
                id:'a',
                type:'line',
                smooth:true,
                symbolSize:symbolSize,
                data:data
            }
        ]
    };

    myecharts.setOption(option);
    let app={};
    if(!app.inNode){
        setTimeout(function () {
            myecharts.setOption({
                graphic:echarts.util.map(data,function (item,dataIndex) {
                    return {
                        type:'circle',
                        position:myecharts.convertToPixel('grid',item),
                        shape:{
                            cx:0,
                            cy:0,
                            r:symbolSize/2
                        },
                        invisible:true,
                        draggable:true,
                        ondrag:echarts.util.curry(onPointDragging,dataIndex),
                        onmousemove:echarts.util.curry(showtoolTip,dataIndex),
                        onmouseout:echarts.util.curry(hidetoolTip,dataIndex),
                        z:100
                    }
                })
            });
        },0);
        window.addEventListener('resize',updatePosition);
    }
    myecharts.on('dataZoom',updatePosition);
    function updatePosition() {
        myecharts.setOption({
            graphic:echarts.util.map(data,function (item,dataIndex) {
                return {
                    position:myecharts.convertToPixel('grid',item)
                }
            })
        })
    }
    function showtoolTip(dataIndex) {
        myecharts.dispatchAction({
            type:'showTip',
            seriesIndex:0,
            dataIndex:dataIndex
        })
    }
    function hidetoolTip(dataIndex) {
        myecharts.dispatchAction({
            type:'hideTip'
        })
    }
    function onPointDragging(dataIndex) {
        data[dataIndex]=myecharts.convertFromPixel('grid',this.position);
        myecharts.setOption({
            series:[{
                id:'a',
                data:data
            }]
        })
    }
</script>
</body>
</html>