<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../public/header.js"></script>
</head>
<body>
<script>

    const myChart=echarts.init(document.getElementById('main1'));
    const uploadedDataURL = "./public/json/温州.json";
    myChart.showLoading();
    $.getJSON(uploadedDataURL, function(geoJson) {
        echarts.registerMap('wenzhou', geoJson);
        myChart.hideLoading();
		const geoCoordMap = {
			'苍南县': [120.427619, 27.419773],
			'洞头区': [121.157249, 27.836154],
			'乐清市': [120.983906, 28.113725],
			'龙湾区': [120.821213, 27.902747],
			'鹿城区': [120.655271, 28.015737],
			'瓯海区': [120.44491, 27.996844],
			'平阳县': [120.565793, 27.661918],
			'瑞安市': [120.355148, 27.778657],
			'泰顺县': [119.717649, 27.556884],
			'文成县': [120.01498, 27.786996],
			'永嘉县': [120.692025, 28.283607],
		};

		const data = [
			{name: '苍南县', value: 190009},
			{name: '洞头区', value: 390000},
			{name: '龙湾区', value: 150002},
			{name: '鹿城区', value: 290009},
			{name: '平阳县', value: 189000},
			{name: '瑞安市', value: 252000},
			{name: '泰顺县', value: 190000},
			{name: '文成县', value: 135002},
			{name: '永嘉县', value: 400009},
			{name: '瓯海区', value: 139000},
			{name: '乐清市', value: 380000},
		];

		const convertData = function (data) {
			const res = [];
			for (let i = 0; i < data.length; i++) {
				const geoCoord = geoCoordMap[data[i].name];
				if (geoCoord) {
					res.push({
						name: data[i].name,
						value: geoCoord.concat(data[i].value).concat(Math.ceil(Math.random() * 100)),
						what: 3
					});
				}
			}
			return res;
		};

		option = {
            backgroundColor:'#000000',
            title: {
                text: '温州',
                subtext: '',
                x: 'center',
                textStyle: {
                    color: '#ccc'
                }
            },
            animation:true,
            tooltip: {
                trigger: 'item',
                formatter: function (params) {
                    if(typeof(params.value)[2] === "undefined"){
                        return params.name + ' : ' + params.value;
                    }else{
                        return params.name + ' : ' + params.value[2];
                    }
                }
            },
            toolbox: {
                show: true,
                orient: 'vertical',
                left: 'right',
                top: 'center',
                feature: {
                        dataView: {readOnly: false},
                        restore: {},
                        saveAsImage: {}
                        }
            },
            geo: {
				show: true,
                map: 'wenzhou',
                label: {
                    normal: {
                        show: false
                    },
                    emphasis: {
                        show: false,
                    }
                },
                roam: true,
                scaleLimit:{
                    min:0.7
                },
                itemStyle: {
                    normal: {
                        areaColor: '#031525',
                        borderColor: '#ffffff',
                    },
                    emphasis: {
                        areaColor: '#2B91B7',
                    }
                }
            },
            series : [
                {
                    name: 'saleArea',
                    type: 'scatter',
                    coordinateSystem: 'geo',
                    data: convertData(data),
                    symbolSize: function (val) {
                        return 2.5;
                    },
                    label: {
                        normal: {
                            formatter: '{b}',
                            position: 'right',
                            show: true
                        },
                        emphasis: {
                            show: true
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: '#05C3F9'
                        }
                    }
                },
                {
                    type: 'map',
                    map: 'wenzhou',
                    geoIndex: 0,
                    aspectScale: 0.75, //长宽比
                    showLegendSymbol: false, // 存在legend时显示
                    label: {
                        normal: {
                            show: false
                        },
                        emphasis: {
                            show: false,
                            textStyle: {
                                color: '#fff'
                            }
                        }
                    },
                    roam: false,
                    itemStyle: {
                        normal: {
                            areaColor: '#031525',
                            borderColor: '#3B5077',
                        },
                        emphasis: {
                            areaColor: '#2B91B7'
                        }
                    },
                    animation: false,
                    data: data
                },
                {
                    name: '点',
                    type: 'scatter',
                    coordinateSystem: 'geo',
                    symbol: 'pin',
                    symbolSize: function (val) {
                        return 90;
                    },
                    label: {
                        normal: {
                            show: true,
                            formatter:function (params) {
                                return params.value[2]+'\n'+params.value[3]
                            },
                            textStyle: {
                                color: '#fff',
                                fontSize: 5
                            }
                        }
                    },
                    itemStyle: {
                        normal: {
                            color: '#F62157' //标志颜色
                        }
                    },
                    zlevel: 6,
                    data: convertData(data)
                }

            ]
        };

        myChart.setOption(option);
    });

</script>
</body>
</html>