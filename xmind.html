<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>XMind-sdk demo</title>
    <script src="./node_modules/jquery/dist/jquery.js"></script>
    <script src="./node_modules/jszip/dist/jszip.js"></script>
    <style>
        textarea {
            width: 100%;
            height: 200px;
        }
    </style>
</head>
<body>
<textarea id="code-to-run">
var workbook = new xmind.Workbook();
var primarySheet = workbook.getPrimarySheet();
var rootTopic = primarySheet.getRootTopic();
rootTopic.setTitle('test another title');
var secondTopic = rootTopic.addChild({
    id: 'secondTopic',
    title: 'second topic'
});
xmind.save(workbook, 'test.xmind');
    </textarea>
<h3>Choose the local(s) zip file(s)</h3>
<p class="note">Note : your browser will process the zip file, don't choose a file too big !</p>

<div id="result_block" class="hidden">
    <h3>Content :</h3>
    <div id="result"></div>
</div>
<button onclick="runCode();">Run!</button>
<input type="file" id="file" multiple>
<script src="./node_modules/xmind/dist/xmind.js"></script>
<script>
    var zip = new JSZip();
    function runCode() {
        var codeElem = document.getElementById('code-to-run');
        eval(codeElem.value);
    }
    function uploadFile(files) {
        console.log(files[0]);
        zip.loadAsync(files[0].name).then(res=>{
            res.forEach((a,b)=>{
                console.log(a, b);
            })
        })
        // var workbook = xmind.open(files[0].name);
        // var sheet = workbook.getPrimarySheet()
        // var Topic = sheet.getRootTopic()
        // console.log(Topic);
    }
    var $result = $("#result");
    $("#file").on("change", function(evt) {
        // remove content
        $result.html("");
        // be sure to show the results
        $("#result_block").removeClass("hidden").addClass("show");

        // Closure to capture the file information.
        function handleFile(f) {
            var $title = $("<h4>", {
                text : f.name
            });
            var $fileContent = $("<ul>");
            $result.append($title);
            $result.append($fileContent);
            var workbook = xmind.open(f.name);
            var dateBefore = new Date();
            JSZip.loadAsync(f)                                   // 1) read the Blob
                .then(function(zip) {
                    var dateAfter = new Date();
                    $title.append($("<span>", {
                        "class": "small",
                        text:" (loaded in " + (dateAfter - dateBefore) + "ms)"
                    }));
                    console.log(zip);
                    zip.forEach(function (relativePath, zipEntry) {  // 2) print entries
                        $fileContent.append($("<li>", {
                            text : zipEntry.name
                        }));
                    });
                }, function (e) {
                    $result.append($("<div>", {
                        "class" : "alert alert-danger",
                        text : "Error reading " + f.name + ": " + e.message
                    }));
                });
        }

        var files = evt.target.files;
        for (var i = 0; i < files.length; i++) {
            handleFile(files[i]);
        }
    });
</script>
</body>
</html>
